{{>navbar}}
<main>
	<a onclick="window.history.back()">
		<button class="go-back">
			<i class="material-icons">arrow_back</i>
		</button>
	</a>

	{{!-- Breadcrumbs --}}
	<div class="inline-flex ml-2 mb-4 items-center place-items-center justify-center text-slate-200">
		<a href="/clientes/{{refUnit.client._id}}">
			<button class="flex items-center">
				<span class="button-icon-container">
					<i class="material-icons icon-clients center" style="display: inline; margin-right: .5rem;">person</i>
				</span>
				Cliente
			</button>
		</a>
		<span class="px-2 flex items-center "><i class="material-icons ">chevron_right</i></span>
		<button class="text-slate-200 cursor-text flex items-center ">
			<span class="button-icon-container">
				<i class="material-icons icon-clients center" style="display: inline; margin-right: .5rem;">ac_unit</i>
			</span>
			Equipo
		</button>
	</div>

	<i class="material-icons icon-clients center"
		style="font-size: 70px; display: block; margin-bottom: .2rem;">ac_unit</i>
	<h1 class="title">Información del equipo</h1>

	<section class="mb-4">
		<div class="table-container" style="width: 500px;">
			<table>
				<tr>
					<th>Nombre Cliente:</th>
					<td>
						{{refUnit.client.name}}
					</td>
				</tr>
				<tr>
					<th>Nº Serie:</th>
					<td> {{refUnit.serialNumber}} </td>
				</tr>
				<tr>
					<th>Modelo:</th>
					<td> {{refUnit.model}} </td>
				</tr>
				<tr>
					<th>Servicios:</th>
					<td>{{refUnit.services.length}}</td>
				</tr>
				<tr>
					<th>Matrícula:</th>
					<td>
						{{refUnit.plate}}
					</td>
				</tr>
				<tr>
					<th>
						Fecha límite de garantía:
					</th>
					<td>
						{{#if refUnit.warrantyDate}}
						{{formatDate refUnit.warrantyDate}}
						{{else}}
						Sin garantía
						{{/if}}
					</td>
				</tr>
				<tr>
					<th>Venta RECI:</th>
					<td>
						{{#if refUnit.soldByReci}}
						<span style="font-weight: 600; color: var(--primary-success);">
							Sí
						</span>
						{{else}}
						<span style="font-weight: 500; color: var(--primary-danger);">
							No
						</span>
						{{/if}}
					</td>
				</tr>
			</table>
		</div>

		<a href="/equipos/editar/{{refUnit._id}}">
			<button class="button-new">
				<i class="material-icons clients-icon center">edit</i>
				Editar
			</button>
		</a>
	</section>



	<div class="grid grid-cols-1 gap-8 sm:gap-6 md:grid-cols-2 mb-8">
		{{!-- SERVICIOS --}}
		<section>
			<h2 class="subtitle mt-0" style="display: flex;">
				<i class="material-icons icon-clients center"
					style=" display: inline; margin:0 .5rem 0 0; font-size: 1.3rem; align-self: center;">build</i>
				Servicios
			</h2>

			{{#if refUnit.services}}
			<div class="table-container" style="width: 100%; min-width: 300px;">
				<table>
					<tr class="bg-slate-200 hover:bg-slate-200" style="padding-block: 0 !important;">
						<th class="py-2"># Orden</th>
						<th class="py-2">Fecha</th>
						<th class="py-2 text-center">Reparaciones</th>
						<th class="py-2 text-center">Repuestos</th>
					</tr>
					{{#each refUnit.services}}
					<tr>
						<td><a href="/servicios/{{this._id}}"><strong>{{this.orderNumber}}</strong></a></td>
						<td><a href="/servicios/{{this._id}}">{{formatDate this.serviceDate}}</a></td>
						<td style="text-align: center;"><a href="/servicios/{{this._id}}">{{this.fixes.length}}</a></td>
						<td style="text-align: center;"><a href="/servicios/{{this._id}}">{{this.parts.length}}</a></td>
					</tr>
					{{/each}}
				</table>
			</div>

			{{else}}
			<h3 class="no-elements center" style="margin-top: 1rem; font-size: 1.1rem;">No hay servicios registrados en
				este
				equipo.</h3>
			{{/if}}

			<a href="/servicios/nuevo/{{refUnit._id}}">
				<button class="button-success center">
					<i class="material-icons clients-icon center">build</i>
					Nuevo servicio
				</button>
			</a>
		</section>

		{{!-- Tareas Pendientes --}}
		<section id="pendingTasks">
			<h2 class="subtitle mt-0" style="display: flex;">
				<i class="material-icons icon-clients center"
					style=" display: inline; margin:0 .5rem 0 0; font-size: 1.3rem; align-self: center;">schedule</i>
				Tareas pendientes
			</h2>

			{{#if refUnit.pendingTasks}}
			<div class="table-container m-0 mb-3" style="width: 100%; min-width: 300px;">
				<table>
					<tr class="bg-slate-200 hover:bg-slate-200" style="padding-block: 0 !important;">
						<th class="py-2">Descripción</th>
						<th class="text-center py-2">Estado</th>
						<th class="py-2">Editar</th>
					</tr>

					{{#each refUnit.pendingTasks}}
					<tr>
						<td class="px-4 uppercase w-10/12">
							{{this.taskDescription}}
						</td>

						{{#if this.completed}}
						<td class="px-4 flex justify-start items-center hover:cursor-pointer mark-pending-button"
							id="{{this._id}}">
							<i class="material-icons clients-icon center m-0 text-green-600 hover:text-green-500">
								{{!-- check_circle --}}
								check
							</i>
							<span class="ml-2 text-green-600 font-medium">
								Completada
							</span>

							{{else}}
						<td class="px-4 flex justify-start items-center hover:cursor-pointer mark-completed-button"
							id="{{this._id}}">
							<i class="material-icons clients-icon center m-0 text-yellow-600">
								warning
							</i>
							<span class="ml-2 text-yellow-600 font-medium">
								Pendiente
							</span>
						</td>
						{{/if}}

						<td>
							<a href="/tareas/editar/{{this._id}}">
								<span class="table-icon-container flex justify-center"><img src="/assets/edit-icon.png"
										alt=""></span>
							</a>
						</td>

					</tr>
					{{/each}}
				</table>
			</div>

			{{else}}
			<h3 class="no-elements center" style="margin-top: 1rem; font-size: 1.1rem;">
				No hay tareas pendientes en este equipo.
			</h3>
			{{/if}}

			{{!-- ADD PENDING TASK FORM --}}
			<form action="/tareas" method="POST">
				<label for="task-description" class="text-slate-200">Nueva
					tarea:</label>
				<div class="justify-center items-center mb-4">
					<input type="text" placeholder="Descripción" name="taskDescription" class="uppercase mt-1 w-full">
				</div>

				{{!-- Hidden Inputs --}}
				<input type="hidden" value="{{refUnit._id}}" name="refUnit">
				<input type="hidden" value="{{refUnit.client._id}}" name="client">

				<button class="button-success center" type="submit">
					<i class="material-icons clients-icon center ml-0">schedule</i>
					Agregar
				</button>
			</form>

		</section>
	</div>
</main>

{{#each scripts}}
<script src="{{script}}"></script>
{{/each}}