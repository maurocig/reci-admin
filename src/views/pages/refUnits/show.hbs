{{>navbar}}
<main class="mt-[80px]">
	<a onclick="window.history.back()">
		<button class="go-back">
			<i class="material-icons">arrow_back</i>
		</button>
	</a>

	{{!-- Breadcrumbs --}}
	<div class="inline-flex items-center justify-center mb-4 ml-2 place-items-center text-slate-200">
		<a href="/clientes/{{refUnit.client._id}}">
			<button class="flex items-center">
				<span class="button-icon-container">
					<i class="material-icons icon-clients center" style="display: inline; margin-right: .5rem;">person</i>
				</span>
				{{refUnit.client.name}}
			</button>
		</a>
		<span class="flex items-center px-2 "><i class="material-icons ">chevron_right</i></span>
		<button class="flex items-center text-slate-200 cursor-text ">
			<span class="button-icon-container">
				<i class="material-icons icon-clients center" style="display: inline; margin-right: .5rem;">ac_unit</i>
			</span>
			{{#if refUnit.plate}}
			{{refUnit.plate}}
			{{else}}
			Sin matricular
			{{/if}}
		</button>
	</div>

	<i class="material-icons icon-clients center"
		style="font-size: 70px; display: block; margin-bottom: .2rem;">ac_unit</i>
	<h1 class="title">Equipo {{refUnit.plate}}</h1>

	<section class="mx-auto mb-4">
		<div class="table-container max-w-[500px]" style="">
			<table id="show-table">
				<tr>
					<th>Nº Serie</th>
					{{#if refUnit.soldByReci}}
					<td class="text-emerald-600 font-normal"> {{refUnit.serialNumber}} </td>
					{{else}}
					<td> {{refUnit.serialNumber}} </td>
					{{/if}}
				</tr>
				</tr>
				<th>Modelo</th>
				<td> {{refUnit.model}} </td>
				</tr>
				<tr>
					<th>Matrícula</th>
					<td>
						{{#if refUnit.plate}}
						{{refUnit.plate}}
						{{else}}
						<div class="text-red-700">No registra</div>
						{{/if}}
					</td>
				</tr>
				<tr>
					<th>Nombre Cliente</th>
					<td>
						{{refUnit.client.name}}
					</td>
				<tr>
					<th>Servicios</th>
					<td>{{refUnit.services.length}}</td>
				</tr>
				<tr>
					<th>
						Fecha límite de garantía
					</th>
					<td>
						{{#if refUnit.warrantyDate}}
						{{formatDate refUnit.warrantyDate}}
						{{else}}
						Sin garantía
						{{/if}}
					</td>
				</tr>
				<tr>
					<th>Venta RECI</th>
					<td>
						{{#if refUnit.soldByReci}}
						Sí
						{{else}}
						No
						{{/if}}
					</td>
				</tr>
				<tr>
					<th>Creado</th>
					<td>{{formatDate refUnit.createdAt}}</td>
				</tr>
			</table>
		</div>

		<a href="/equipos/editar/{{refUnit._id}}">
			<button class="button-new">
				<i class="material-icons clients-icon center">edit</i>
				Editar
			</button>
		</a>
	</section>

	<div class="grid grid-cols-1 gap-8 mb-2 sm:gap-6 md:grid-cols-2">
		{{!-- SERVICIOS --}}
		<section>
			<h2 class="mt-0 subtitle" style="display: flex;">
				<i class="material-icons icon-clients center"
					style=" display: inline; margin:0 .5rem 0 0; font-size: 1.3rem; align-self: center;">build</i>
				Servicios
			</h2>

			{{#if refUnit.services}}
			<div class="table-container" style="width: 100%; min-width: 300px;">
				<table>
					<tr class="bg-slate-200 hover:bg-slate-200" style="padding-block: 0 !important;">
						<th class="py-2"># Orden</th>
						<th class="py-2">Fecha</th>
						<th class="hidden py-2 text-center sm:table-cell">Reparaciones</th>
						<th class="hidden py-2 text-center sm:table-cell">Repuestos</th>
					</tr>
					{{#each refUnit.services}}
					<tr>
						<td><a href="/servicios/{{this._id}}">{{this.orderNumber}}</a></td>
						<td><a href="/servicios/{{this._id}}">{{formatDate this.serviceDate}}</a></td>
						<td class="hidden sm:table-cell" style="text-align: center;"><a
								href="/servicios/{{this._id}}">{{this.fixes.length}}</a></td>
						<td class="hidden sm:table-cell" style="text-align: center;"><a
								href="/servicios/{{this._id}}">{{this.parts.length}}</a></td>
					</tr>
					{{/each}}
				</table>
			</div>

			{{else}}
			<h3 class="no-elements center" style="font-size: 1.1rem;">No hay servicios registrados en
				este
				equipo.</h3>
			{{/if}}

			<a href="/servicios/nuevo/{{refUnit._id}}">
				<button class="button-success center">
					<i class="material-icons clients-icon center">build</i>
					Nuevo servicio
				</button>
			</a>
		</section>

		{{!-- Tareas Pendientes --}}
		<section id="pendingTasks">
			<h2 class="mt-0 subtitle" style="display: flex;">
				<i class="material-icons icon-clients center"
					style=" display: inline; margin:0 .5rem 0 0; font-size: 1.3rem; align-self: center;">schedule</i>
				Tareas pendientes
			</h2>

			{{#if refUnit.pendingTasks}}
			<div class="m-0 mb-3 table-container" style="width: 100%; min-width: 300px;">
				<table>
					<tr class="bg-slate-200 hover:bg-slate-200" style="padding-block: 0 !important;">
						<th class="py-2">Descripción</th>
						<th class="py-2 text-center">Estado</th>
						<th class="py-2">Editar</th>
					</tr>

					{{#each refUnit.pendingTasks}}
					<tr>
						<td class="w-10/12 px-4 uppercase">
							{{this.taskDescription}}
						</td>

						{{#if this.completed}}
						<td class="flex items-center justify-start px-4 hover:cursor-pointer mark-pending-button" id="{{this._id}}">
							<i class="m-0 text-green-600 material-icons clients-icon center hover:text-green-500">
								{{!-- check_circle --}}
								check
							</i>
							<span class="ml-2 font-medium text-green-600">
								Completada
							</span>

							{{else}}
						<td class="flex items-center justify-start px-4 hover:cursor-pointer mark-completed-button"
							id="{{this._id}}">
							<i class="m-0 text-yellow-600 material-icons clients-icon center">
								warning
							</i>
							<span class="ml-2 font-medium text-yellow-600">
								Pendiente
							</span>
						</td>
						{{/if}}

						<td>
							<a href="/tareas/editar/{{this._id}}">
								<span class="flex justify-center table-icon-container"><img src="/assets/edit-icon.png" alt=""></span>
							</a>
						</td>

					</tr>
					{{/each}}
				</table>
			</div>

			{{else}}
			<h3 class="no-elements center" style="font-size: 1.1rem;">
				No hay tareas pendientes en este equipo.
			</h3>
			{{/if}}

			{{!-- ADD PENDING TASK FORM --}}
			<form action="/tareas" method="POST" class="flex flex-col items-center w-full">
				<div class="items-center justify-center mb-4 min-w-[300px] w-full ">
					<input type="text" placeholder="Nueva tarea" name="taskDescription" class="mt-1 p-2 w-full uppercase w-grow">
				</div>

				{{!-- Hidden Inputs --}}
				<input type="hidden" value="{{refUnit._id}}" name="refUnit">
				<input type="hidden" value="{{refUnit.client._id}}" name="client">

				<button class="button-success center" type="submit">
					<i class="ml-0 material-icons clients-icon center">schedule</i>
					Agregar
				</button>
			</form>

		</section>
	</div>

	{{!-- List all fixes --}}
	<section class="w-full">
		<h2 class="mt-0 subtitle" style="display: flex;">
			<i class="material-icons icon-clients center"
				style=" display: inline; margin:0 .5rem 0 0; font-size: 1.3rem; align-self: center;">check</i>
			Tareas realizadas
		</h2>

		{{#if refUnit.services}}
		<div class="table-container" style="width: 100%; min-width: 300px;">
			<table>
				<tr class="bg-slate-200 hover:bg-slate-200" style="padding-block: 0 !important;">
					<th class="hidden py-2 text-start sm:table-cell">Tarea</th>
					<th class="py-2 w-[100px]"># Orden</th>
					<th class="py-2 w-[50px]">Fecha</th>
					<th class="py-2 w-[50px] hidden sm:table-cell">Repuestos</th>
					{{!-- <th class="hidden py-2 text-center sm:table-cell">Repuestos</th> --}}
				</tr>
				{{#each refUnit.services}}
				{{#each this.fixes}}
				{{#if (isOdd @../index)}}
				<tr class="bg-cyan-600/5">
					{{else}}
				<tr>
					{{/if}}
					<td>
						<a href="/servicios/{{../this._id}}">{{this.fixName}}</a>
					</td>
					<td class="hidden sm:table-cell ">
						<a href="/servicios/{{../this._id}}">{{../this.orderNumber}}</a>
					</td>
					<td>
						<a href="/servicios/{{../this._id}}">{{formatDate ../this.serviceDate}}</a>
					</td>
					<td class="text-center hidden sm:table-cell">
						<a href="/servicios/{{../this._id}}">{{../this.parts.length}}</a>
					</td>
				</tr>
				{{/each}}
				{{/each}}
			</table>
		</div>
		{{/if}}

	</section>
</main>

{{#each scripts}}
<script src="{{script}}"></script>
{{/each}}